# proxyDHCP that offers net booting, this configuration relies
# on another DHCP server assigning IP addresses and an available DNS server.

log-queries
log-dhcp
no-daemon

# Might need to bind a specific interface if systemd-resolved is running.
# interface=wlp2s0
# bind-dynamic

# My LAN is 10.0.0.0/16
dhcp-range=10.0.0.0,proxy,255.255.0.0
dhcp-lease-max=1000
dhcp-no-override # Avoid problems with old or broken clients.
strict-order # https://www.redhat.com/archives/libvir-list/2010-March/msg00038.html

enable-tftp
tftp-root=/var/lib/tftpboot

###
# MULTIARCH NETBOOT CONFIG
###

# Legacy PXE: Chainload to iPXE with undionly.pxe
dhcp-match=set:bios,option:client-arch,0
dhcp-boot=tag:bios,undionly.kpxe

# RPI4 UEFI to iPXE chainload
dhcp-match=set:rpi4,option:client-arch,11
dhcp-boot=tag:rpi4,ipxe-arm64.efi

# RPI4 Net Boot (TFTP)
pxe-service=0,"Raspberry Pi Boot",boot.img

# UEFI to iPXE (x86)
dhcp-match=set:efi32,option:client-arch,6
dhcp-match=set:efibc,option:client-arch,7
dhcp-match=set:efi64,option:client-arch,9

dhcp-boot=tag:efi32,ipxe.efi
dhcp-boot=tag:efibc,ipxe.efi
dhcp-boot=tag:efi64,ipxe.efi

# iPXE clients: Go to Matchbox server
dhcp-userclass=set:ipxe,iPXE
dhcp-boot=tag:ipxe,http://th1nk.lan:8080/boot.ipxe
